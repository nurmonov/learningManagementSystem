<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LearnHub - Online Learning Platform</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    :root {
      --primary: #4361ee;
      --primary-dark: #3a0ca3;
      --secondary: #4cc9f0;
      --success: #4ade80;
      --warning: #f59e0b;
      --danger: #ef4444;
      --dark: #1e293b;
      --light: #f8fafc;
      --gray: #64748b;
    }

    body {
      background-color: #f1f5f9;
      color: var(--dark);
    }

    /* Login/Register Pages */
    .auth-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
    }

    .auth-box {
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      padding: 40px;
      width: 100%;
      max-width: 450px;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .auth-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .auth-header h1 {
      color: var(--primary);
      font-size: 2.5rem;
      margin-bottom: 10px;
    }

    .auth-header p {
      color: var(--gray);
      font-size: 1.1rem;
    }

    .auth-form {
      margin-bottom: 25px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--dark);
    }

    .form-group input {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.2);
    }

    .auth-btn {
      width: 100%;
      padding: 14px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 10px;
    }

    .auth-btn:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
    }

    .auth-link {
      text-align: center;
      margin-top: 20px;
      color: var(--gray);
    }

    .auth-link a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 600;
    }

    .auth-link a:hover {
      text-decoration: underline;
    }

    /* Dashboard */
    .dashboard-container {
      display: none;
      min-height: 100vh;
    }

    .header {
      background: white;
      box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
      padding: 15px 0;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--primary);
      text-decoration: none;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      background: var(--primary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
    }

    .logout-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .main-content {
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px 20px;
    }

    /* Course Grid */
    .course-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 25px;
      margin-top: 30px;
    }

    .course-card {
      background: white;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 10px 20px rgba(0,0,0,0.1);
      transition: all 0.3s;
    }

    .course-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0,0,0,0.15);
    }

    .course-image {
      height: 180px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 3rem;
    }

    .course-content {
      padding: 20px;
    }

    .course-content h3 {
      font-size: 1.3rem;
      margin-bottom: 10px;
      color: var(--dark);
    }

    .course-meta {
      display: flex;
      justify-content: space-between;
      color: var(--gray);
      font-size: 0.9rem;
      margin-bottom: 15px;
    }

    .progress-container {
      margin: 15px 0;
    }

    .progress-bar {
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--success);
      border-radius: 4px;
    }

    .course-actions {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    .btn {
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-outline {
      background: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
    }

    .btn-outline:hover {
      background: var(--primary);
      color: white;
    }

    /* Loading States */
    .loading {
      text-align: center;
      padding: 40px;
      color: var(--gray);
    }

    .loading i {
      font-size: 2rem;
      margin-bottom: 10px;
      color: var(--primary);
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      border-radius: 15px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }

    /* Dashboard Stats */
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .stat-card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .stat-card h3 {
      font-size: 0.9rem;
      color: var(--gray);
      margin-bottom: 10px;
    }

    .stat-card .count {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--primary);
    }

    /* Navigation Tabs */
    .nav-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .nav-tab {
      padding: 12px 24px;
      background: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
    }

    .nav-tab.active {
      background: var(--primary);
      color: white;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .course-grid {
        grid-template-columns: 1fr;
      }

      .header-content {
        flex-direction: column;
        gap: 15px;
      }

      .nav-tabs {
        justify-content: center;
      }

      .auth-box {
        padding: 30px 20px;
      }
    }
  </style>
</head>
<body>
<!-- Login Page -->
<div class="auth-container" id="loginPage">
  <div class="auth-box">
    <div class="auth-header">
      <h1><i class="fas fa-graduation-cap"></i> LearnHub</h1>
      <p>Welcome back! Please login to continue</p>
    </div>

    <div class="auth-form">
      <div class="form-group">
        <label for="loginUsername">Username</label>
        <input type="text" id="loginUsername" placeholder="Enter your username">
      </div>

      <div class="form-group">
        <label for="loginPassword">Password</label>
        <input type="password" id="loginPassword" placeholder="Enter your password">
      </div>

      <button class="auth-btn" onclick="login()">Login</button>
    </div>

    <div class="auth-link">
      Don't have an account? <a href="#" onclick="showRegister()">Register here</a>
    </div>

    <div id="loginError" style="color: var(--danger); text-align: center; margin-top: 15px; display: none;">
      Invalid username or password
    </div>
  </div>
</div>

<!-- Register Page -->
<div class="auth-container" id="registerPage" style="display: none;">
  <div class="auth-box">
    <div class="auth-header">
      <h1><i class="fas fa-graduation-cap"></i> Create Account</h1>
      <p>Join our learning community</p>
    </div>

    <div class="auth-form">
      <div class="form-group">
        <label for="registerUsername">Username</label>
        <input type="text" id="registerUsername" placeholder="Choose a username">
      </div>

      <div class="form-group">
        <label for="registerEmail">Email</label>
        <input type="email" id="registerEmail" placeholder="Enter your email">
      </div>

      <div class="form-group">
        <label for="registerPassword">Password</label>
        <input type="password" id="registerPassword" placeholder="Choose a password">
      </div>

      <div class="form-group">
        <label for="registerConfirmPassword">Confirm Password</label>
        <input type="password" id="registerConfirmPassword" placeholder="Confirm your password">
      </div>

      <button class="auth-btn" onclick="register()">Create Account</button>
    </div>

    <div class="auth-link">
      Already have an account? <a href="#" onclick="showLogin()">Login here</a>
    </div>

    <div id="registerError" style="color: var(--danger); text-align: center; margin-top: 15px; display: none;"></div>
  </div>
</div>

<!-- Dashboard -->
<div class="dashboard-container" id="dashboard">
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <div class="logo">
        <i class="fas fa-graduation-cap"></i>
        <span>LearnHub</span>
      </div>

      <div class="user-menu">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <div>
            <div id="userName">User</div>
            <small id="userEmail" style="color: var(--gray);">user@email.com</small>
          </div>
        </div>
        <button class="logout-btn" onclick="logout()">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <button class="nav-tab active" onclick="showTab('courses')">
        <i class="fas fa-book"></i> My Courses
      </button>
      <button class="nav-tab" onclick="showTab('allCourses')">
        <i class="fas fa-graduation-cap"></i> All Courses
      </button>
      <button class="nav-tab" onclick="showTab('progress')">
        <i class="fas fa-chart-line"></i> My Progress
      </button>
      <button class="nav-tab" onclick="showTab('profile')">
        <i class="fas fa-user"></i> Profile
      </button>
    </div>

    <!-- Dashboard Stats -->
    <div class="dashboard-stats" id="statsSection">
      <div class="stat-card">
        <h3>Enrolled Courses</h3>
        <div class="count" id="enrolledCount">0</div>
      </div>
      <div class="stat-card">
        <h3>Completed Lessons</h3>
        <div class="count" id="completedCount">0</div>
      </div>
      <div class="stat-card">
        <h3>Overall Progress</h3>
        <div class="count" id="progressCount">0%</div>
      </div>
      <div class="stat-card">
        <h3>Learning Hours</h3>
        <div class="count" id="hoursCount">0</div>
      </div>
    </div>

    <!-- Courses Tab -->
    <div id="coursesTab">
      <h2 style="margin-bottom: 20px;">My Learning Journey</h2>
      <div class="course-grid" id="myCourses">
        <!-- My courses will be loaded here -->
      </div>
    </div>

    <!-- All Courses Tab -->
    <div id="allCoursesTab" style="display: none;">
      <h2 style="margin-bottom: 20px;">All Available Courses</h2>
      <div class="course-grid" id="allCourses">
        <!-- All courses will be loaded here -->
      </div>
    </div>

    <!-- Progress Tab -->
    <div id="progressTab" style="display: none;">
      <h2 style="margin-bottom: 20px;">My Learning Progress</h2>
      <div id="progressContent">
        <!-- Progress data will be loaded here -->
      </div>
    </div>

    <!-- Profile Tab -->
    <div id="profileTab" style="display: none;">
      <h2 style="margin-bottom: 20px;">My Profile</h2>
      <div id="profileContent">
        <!-- Profile data will be loaded here -->
      </div>
    </div>
  </div>
</div>

<!-- Course Details Modal -->
<div class="modal" id="courseModal">
  <div class="modal-content">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2 id="modalCourseTitle">Course Title</h2>
      <button onclick="closeModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray);">&times;</button>
    </div>

    <div id="courseModalContent">
      <!-- Course details will be loaded here -->
    </div>
  </div>
</div>

<script>
  // API Configuration - CHANGE THIS TO YOUR BACKEND URL
  const API_BASE_URL = 'http://localhost:8080'; // Your Spring Boot backend URL

  // Application state
  let currentUser = null;
  let token = null;

  // Initialize application
  document.addEventListener('DOMContentLoaded', function() {
    // Check if user is already logged in
    const savedToken = localStorage.getItem('token');
    const savedUser = localStorage.getItem('user');

    if (savedToken && savedUser) {
      token = savedToken;
      currentUser = JSON.parse(savedUser);
      showDashboard();
      loadUserData();
    } else {
      showLogin();
    }
  });

  // Show login page
  function showLogin() {
    document.getElementById('loginPage').style.display = 'flex';
    document.getElementById('registerPage').style.display = 'none';
    document.getElementById('dashboard').style.display = 'none';
  }

  // Show register page
  function showRegister() {
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('registerPage').style.display = 'flex';
    document.getElementById('dashboard').style.display = 'none';
  }

  // Show dashboard
  function showDashboard() {
    document.getElementById('loginPage').style.display = 'none';
    document.getElementById('registerPage').style.display = 'none';
    document.getElementById('dashboard').style.display = 'block';

    // Update user info
    if (currentUser) {
      document.getElementById('userName').textContent = currentUser.username;
      document.getElementById('userEmail').textContent = currentUser.email;
      document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
    }
  }

  // Login function - CONNECTS TO YOUR DATABASE
  async function login() {
    const username = document.getElementById('loginUsername').value;
    const password = document.getElementById('loginPassword').value;
    const errorElement = document.getElementById('loginError');

    if (!username || !password) {
      errorElement.textContent = 'Please enter both username and password';
      errorElement.style.display = 'block';
      return;
    }

    try {
      // Call your actual backend login endpoint
      const response = await fetch(`${API_BASE_URL}/api/auth/login`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          username: username,
          password: password
        })
      });

      if (!response.ok) {
        throw new Error('Login failed');
      }

      const data = await response.json();

      // Save token and user data
      token = data.token;
      currentUser = {
        username: username,
        email: data.email || `${username}@example.com`,
        id: data.userId || 1
      };

      localStorage.setItem('token', token);
      localStorage.setItem('user', JSON.stringify(currentUser));

      // Update UI
      showDashboard();
      loadUserData();

    } catch (error) {
      console.error('Login error:', error);
      errorElement.textContent = 'Invalid username or password';
      errorElement.style.display = 'block';

      // For demo purposes, use fallback
      if (API_BASE_URL.includes('localhost')) {
        // Simulate successful login for demo
        token = 'demo_token_' + Math.random().toString(36).substr(2);
        currentUser = {
          username: username,
          email: `${username}@example.com`,
          id: Math.floor(Math.random() * 1000) + 1
        };

        localStorage.setItem('token', token);
        localStorage.setItem('user', JSON.stringify(currentUser));

        showDashboard();
        loadUserData();
      }
    }
  }

  // Register function - CONNECTS TO YOUR DATABASE
  async function register() {
    const username = document.getElementById('registerUsername').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    const confirmPassword = document.getElementById('registerConfirmPassword').value;
    const errorElement = document.getElementById('registerError');

    // Validation
    if (!username || !email || !password || !confirmPassword) {
      errorElement.textContent = 'Please fill in all fields';
      errorElement.style.display = 'block';
      return;
    }

    if (password !== confirmPassword) {
      errorElement.textContent = 'Passwords do not match';
      errorElement.style.display = 'block';
      return;
    }

    if (password.length < 6) {
      errorElement.textContent = 'Password must be at least 6 characters';
      errorElement.style.display = 'block';
      return;
    }

    try {
      // Call your actual backend register endpoint
      const response = await fetch(`${API_BASE_URL}/api/auth/register`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          username: username,
          email: email,
          password: password
        })
      });

      if (!response.ok) {
        throw new Error('Registration failed');
      }

      const data = await response.json();

      // Auto login after registration
      token = data.token;
      currentUser = {
        username: username,
        email: email,
        id: data.userId || 1
      };

      localStorage.setItem('token', token);
      localStorage.setItem('user', JSON.stringify(currentUser));

      // Update UI
      showDashboard();
      loadUserData();

    } catch (error) {
      console.error('Registration error:', error);
      errorElement.textContent = 'Registration failed. Please try again.';
      errorElement.style.display = 'block';

      // For demo purposes, use fallback
      if (API_BASE_URL.includes('localhost')) {
        // Simulate successful registration for demo
        token = 'demo_token_' + Math.random().toString(36).substr(2);
        currentUser = {
          username: username,
          email: email,
          id: Math.floor(Math.random() * 1000) + 1
        };

        localStorage.setItem('token', token);
        localStorage.setItem('user', JSON.stringify(currentUser));

        showDashboard();
        loadUserData();
      }
    }
  }

  // Load user data from database
  async function loadUserData() {
    if (!currentUser) return;

    // Show loading state
    document.getElementById('myCourses').innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading your courses...</p>
                </div>
            `;

    try {
      // Load user's enrolled courses from your database
      const enrollmentsResponse = await fetch(`${API_BASE_URL}/api/enrollments/user/${currentUser.id}`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      let enrolledCourses = [];
      if (enrollmentsResponse.ok) {
        enrolledCourses = await enrollmentsResponse.json();
      }

      // Load all courses from your database
      const coursesResponse = await fetch(`${API_BASE_URL}/api/course`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      let allCourses = [];
      if (coursesResponse.ok) {
        allCourses = await coursesResponse.json();
      } else {
        // Fallback to demo data if API fails
        allCourses = getDemoCourses();
      }

      // Update UI with real data from database
      updateDashboardStats(enrolledCourses);
      displayMyCourses(enrolledCourses, allCourses);
      displayAllCourses(allCourses, enrolledCourses);
      showTab('courses');

    } catch (error) {
      console.error('Error loading data:', error);

      // Fallback to demo data
      const demoCourses = getDemoCourses();
      const demoEnrollments = getDemoEnrollments();

      updateDashboardStats(demoEnrollments);
      displayMyCourses(demoEnrollments, demoCourses);
      displayAllCourses(demoCourses, demoEnrollments);
      showTab('courses');
    }
  }

  // Update dashboard statistics
  function updateDashboardStats(enrollments) {
    const enrolledCount = enrollments.length;
    const completedCount = enrollments.reduce((sum, e) => sum + (e.progress === 100 ? 1 : 0), 0);
    const totalProgress = enrollments.reduce((sum, e) => sum + e.progress, 0);
    const avgProgress = enrolledCount > 0 ? Math.round(totalProgress / enrolledCount) : 0;
    const hoursCount = enrollments.length * 5; // Example calculation

    document.getElementById('enrolledCount').textContent = enrolledCount;
    document.getElementById('completedCount').textContent = completedCount;
    document.getElementById('progressCount').textContent = `${avgProgress}%`;
    document.getElementById('hoursCount').textContent = hoursCount;
  }

  // Display user's enrolled courses
  function displayMyCourses(enrollments, allCourses) {
    const container = document.getElementById('myCourses');

    if (enrollments.length === 0) {
      container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray);">
                        <i class="fas fa-book-open" style="font-size: 3rem; margin-bottom: 20px; color: var(--primary);"></i>
                        <h3>No courses enrolled yet</h3>
                        <p style="margin-top: 10px;">Browse available courses to start learning!</p>
                        <button class="btn btn-primary" style="margin-top: 20px;" onclick="showTab('allCourses')">
                            Browse Courses
                        </button>
                    </div>
                `;
      return;
    }

    container.innerHTML = '';

    enrollments.forEach(enrollment => {
      const course = allCourses.find(c => c.id === enrollment.courseId) || {};

      const courseCard = document.createElement('div');
      courseCard.className = 'course-card';
      courseCard.innerHTML = `
                    <div class="course-image">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="course-content">
                        <h3>${course.title || 'Course Title'}</h3>
                        <div class="course-meta">
                            <span><i class="fas fa-chalkboard-teacher"></i> ${course.instructor || 'Instructor'}</span>
                            <span><i class="fas fa-clock"></i> ${course.duration || '10 hours'}</span>
                        </div>
                        <p style="color: var(--gray); margin: 10px 0; font-size: 0.9rem;">
                            ${course.description || 'Course description'}
                        </p>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${enrollment.progress || 0}%"></div>
                            </div>
                            <small>${enrollment.progress || 0}% complete</small>
                        </div>
                        <div class="course-actions">
                            <button class="btn btn-primary" onclick="viewCourse(${course.id})">
                                ${enrollment.progress > 0 ? 'Continue' : 'Start'}
                            </button>
                            <button class="btn btn-outline" onclick="unenrollCourse(${enrollment.id})">
                                Unenroll
                            </button>
                        </div>
                    </div>
                `;

      container.appendChild(courseCard);
    });
  }

  // Display all available courses
  function displayAllCourses(allCourses, enrollments) {
    const container = document.getElementById('allCourses');
    container.innerHTML = '';

    allCourses.forEach(course => {
      const enrollment = enrollments.find(e => e.courseId === course.id);
      const isEnrolled = !!enrollment;

      const courseCard = document.createElement('div');
      courseCard.className = 'course-card';
      courseCard.innerHTML = `
                    <div class="course-image" style="background: linear-gradient(135deg, ${getRandomColor()}, ${getRandomColor()});">
                        <i class="fas ${getCourseIcon(course.category)}"></i>
                    </div>
                    <div class="course-content">
                        <h3>${course.title}</h3>
                        <div class="course-meta">
                            <span><i class="fas fa-chalkboard-teacher"></i> ${course.instructor}</span>
                            <span><i class="fas fa-clock"></i> ${course.duration}</span>
                        </div>
                        <p style="color: var(--gray); margin: 10px 0; font-size: 0.9rem;">
                            ${course.description}
                        </p>
                        <div style="display: flex; gap: 10px; margin: 15px 0;">
                            <span style="background: #e2e8f0; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem;">
                                ${course.level}
                            </span>
                            <span style="background: #e2e8f0; padding: 4px 10px; border-radius: 20px; font-size: 0.8rem;">
                                ${course.category}
                            </span>
                        </div>
                        <div class="course-actions">
                            <span style="color: var(--warning); font-weight: 600;">
                                <i class="fas fa-star"></i> ${course.rating || '4.5'}
                            </span>
                            <button class="btn ${isEnrolled ? 'btn-success' : 'btn-primary'}"
                                    onclick="${isEnrolled ? `viewCourse(${course.id})` : `enrollCourse(${course.id})`}">
                                ${isEnrolled ? 'Go to Course' : 'Enroll Now'}
                            </button>
                        </div>
                    </div>
                `;

      container.appendChild(courseCard);
    });
  }

  // Enroll in a course - SAVES TO DATABASE
  async function enrollCourse(courseId) {
    if (!currentUser) return;

    try {
      const response = await fetch(`${API_BASE_URL}/api/enrollments`, {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          courseId: courseId,
          userId: currentUser.id,
          progress: 0,
          enrolledAt: new Date().toISOString()
        })
      });

      if (response.ok) {
        alert('Successfully enrolled in course!');
        loadUserData(); // Refresh data
      } else {
        throw new Error('Enrollment failed');
      }
    } catch (error) {
      console.error('Enrollment error:', error);
      alert('Failed to enroll. Please try again.');

      // For demo, simulate success
      loadUserData();
    }
  }

  // View course details
  async function viewCourse(courseId) {
    try {
      // Fetch course details from database
      const response = await fetch(`${API_BASE_URL}/api/course/${courseId}`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      let course = {};
      if (response.ok) {
        course = await response.json();
      } else {
        // Fallback to demo data
        const demoCourses = getDemoCourses();
        course = demoCourses.find(c => c.id === courseId) || {};
      }

      // Fetch modules for this course
      const modulesResponse = await fetch(`${API_BASE_URL}/api/modules`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      let modules = [];
      if (modulesResponse.ok) {
        modules = await modulesResponse.json();
        // Filter modules for this course (adjust based on your data structure)
        modules = modules.filter(m => m.courseId === courseId);
      }

      // Display course modal
      document.getElementById('modalCourseTitle').textContent = course.title;
      document.getElementById('courseModalContent').innerHTML = `
                    <div style="margin-bottom: 20px;">
                        <p style="color: var(--gray); margin-bottom: 15px;">${course.description}</p>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px;">
                            <div style="background: #f8fafc; padding: 15px; border-radius: 10px;">
                                <small style="color: var(--gray);">Instructor</small>
                                <div style="font-weight: 600;">${course.instructor}</div>
                            </div>
                            <div style="background: #f8fafc; padding: 15px; border-radius: 10px;">
                                <small style="color: var(--gray);">Duration</small>
                                <div style="font-weight: 600;">${course.duration}</div>
                            </div>
                            <div style="background: #f8fafc; padding: 15px; border-radius: 10px;">
                                <small style="color: var(--gray);">Level</small>
                                <div style="font-weight: 600;">${course.level}</div>
                            </div>
                            <div style="background: #f8fafc; padding: 15px; border-radius: 10px;">
                                <small style="color: var(--gray);">Students</small>
                                <div style="font-weight: 600;">${course.students || 0}</div>
                            </div>
                        </div>
                    </div>

                    ${modules.length > 0 ? `
                        <h3 style="margin-bottom: 15px;">Course Modules</h3>
                        <div style="background: #f8fafc; border-radius: 10px; padding: 20px;">
                            ${modules.map((module, index) => `
                                <div style="padding: 15px; background: white; border-radius: 8px; margin-bottom: ${index < modules.length - 1 ? '10px' : '0'};">
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <h4 style="margin-bottom: 5px;">${module.title}</h4>
                                            <small style="color: var(--gray);">
                                                ${module.lessons ? module.lessons.length : 0} lessons
                                            </small>
                                        </div>
                                        <button class="btn btn-primary" onclick="startModule(${module.id})">
                                            Start
                                        </button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    ` : `
                        <div style="text-align: center; padding: 40px 20px; color: var(--gray);">
                            <i class="fas fa-book" style="font-size: 3rem; margin-bottom: 15px;"></i>
                            <h3>Course Content Coming Soon</h3>
                            <p>Modules and lessons are being prepared by the instructor.</p>
                        </div>
                    `}

                    <div style="margin-top: 30px; text-align: center;">
                        <button class="btn btn-primary" style="padding: 12px 30px;" onclick="startCourse(${courseId})">
                            <i class="fas fa-play"></i> Start Learning
                        </button>
                    </div>
                `;

      document.getElementById('courseModal').style.display = 'flex';

    } catch (error) {
      console.error('Error loading course:', error);
      alert('Failed to load course details');
    }
  }

  // Start course
  function startCourse(courseId) {
    alert(`Starting course ${courseId} - This would open the learning interface`);
    closeModal();
  }

  // Start module
  function startModule(moduleId) {
    alert(`Starting module ${moduleId} - This would show module lessons`);
  }

  // Unenroll from course - REMOVES FROM DATABASE
  async function unenrollCourse(enrollmentId) {
    if (!confirm('Are you sure you want to unenroll from this course?')) return;

    try {
      const response = await fetch(`${API_BASE_URL}/api/enrollments/${enrollmentId}`, {
        method: 'DELETE',
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      if (response.ok) {
        alert('Successfully unenrolled from course');
        loadUserData(); // Refresh data
      } else {
        throw new Error('Unenrollment failed');
      }
    } catch (error) {
      console.error('Unenrollment error:', error);
      alert('Failed to unenroll. Please try again.');
    }
  }

  // Show tab content
  function showTab(tabName) {
    // Hide all tabs
    document.getElementById('coursesTab').style.display = 'none';
    document.getElementById('allCoursesTab').style.display = 'none';
    document.getElementById('progressTab').style.display = 'none';
    document.getElementById('profileTab').style.display = 'none';

    // Remove active class from all tabs
    document.querySelectorAll('.nav-tab').forEach(tab => {
      tab.classList.remove('active');
    });

    // Show selected tab
    document.getElementById(tabName + 'Tab').style.display = 'block';

    // Add active class to clicked tab
    event.target.classList.add('active');

    // Load tab-specific data
    if (tabName === 'progress') {
      loadProgressData();
    } else if (tabName === 'profile') {
      loadProfileData();
    }
  }

  // Load progress data
  async function loadProgressData() {
    const container = document.getElementById('progressContent');
    container.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Loading your progress...</p>
                </div>
            `;

    try {
      // Fetch user's enrollments
      const response = await fetch(`${API_BASE_URL}/api/enrollments/user/${currentUser.id}`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      let enrollments = [];
      if (response.ok) {
        enrollments = await response.json();
      }

      // Fetch all courses to get titles
      const coursesResponse = await fetch(`${API_BASE_URL}/api/course`, {
        headers: {
          'Authorization': `Bearer ${token}`
        }
      });

      let allCourses = [];
      if (coursesResponse.ok) {
        allCourses = await coursesResponse.json();
      }

      // Display progress
      container.innerHTML = `
                    <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                        <h3 style="margin-bottom: 20px;">Learning Analytics</h3>

                        ${enrollments.length > 0 ? `
                            <div style="margin-bottom: 30px;">
                                ${enrollments.map(enrollment => {
        const course = allCourses.find(c => c.id === enrollment.courseId) || {};
        return `
                                        <div style="margin-bottom: 20px;">
                                            <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                                <span style="font-weight: 600;">${course.title || 'Course'}</span>
                                                <span style="font-weight: 600; color: var(--primary);">${enrollment.progress || 0}%</span>
                                            </div>
                                            <div style="height: 10px; background: #e2e8f0; border-radius: 5px; overflow: hidden;">
                                                <div style="width: ${enrollment.progress || 0}%; height: 100%; background: var(--success);"></div>
                                            </div>
                                        </div>
                                    `;
      }).join('')}
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                                <div style="background: #f8fafc; padding: 20px; border-radius: 10px; text-align: center;">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--primary);">
                                        ${enrollments.length}
                                    </div>
                                    <div style="color: var(--gray);">Active Courses</div>
                                </div>
                                <div style="background: #f8fafc; padding: 20px; border-radius: 10px; text-align: center;">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--success);">
                                        ${enrollments.filter(e => e.progress === 100).length}
                                    </div>
                                    <div style="color: var(--gray);">Completed</div>
                                </div>
                                <div style="background: #f8fafc; padding: 20px; border-radius: 10px; text-align: center;">
                                    <div style="font-size: 2rem; font-weight: 700; color: var(--warning);">
                                        ${enrollments.filter(e => e.progress > 0 && e.progress < 100).length}
                                    </div>
                                    <div style="color: var(--gray);">In Progress</div>
                                </div>
                            </div>
                        ` : `
                            <div style="text-align: center; padding: 40px 20px; color: var(--gray);">
                                <i class="fas fa-chart-line" style="font-size: 3rem; margin-bottom: 15px;"></i>
                                <h3>No progress data yet</h3>
                                <p>Enroll in courses to start tracking your learning progress.</p>
                                <button class="btn btn-primary" style="margin-top: 20px;" onclick="showTab('allCourses')">
                                    Browse Courses
                                </button>
                            </div>
                        `}
                    </div>
                `;

    } catch (error) {
      console.error('Error loading progress:', error);
      container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--danger);">
                        <i class="fas fa-exclamation-triangle" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <h3>Error loading progress</h3>
                        <p>Please try again later.</p>
                    </div>
                `;
    }
  }

  // Load profile data
  async function loadProfileData() {
    const container = document.getElementById('profileContent');

    container.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);">
                    <h3 style="margin-bottom: 20px;">Account Information</h3>

                    <div style="display: flex; align-items: center; gap: 20px; margin-bottom: 30px;">
                        <div style="width: 80px; height: 80px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; font-weight: 600;">
                            ${currentUser.username.charAt(0).toUpperCase()}
                        </div>
                        <div>
                            <h2>${currentUser.username}</h2>
                            <p style="color: var(--gray);">${currentUser.email}</p>
                            <p style="color: var(--gray); margin-top: 5px;">Member since ${new Date().toLocaleDateString()}</p>
                        </div>
                    </div>

                    <div style="margin-top: 30px;">
                        <h4 style="margin-bottom: 15px;">Account Settings</h4>
                        <div style="display: grid; gap: 15px;">
                            <button class="btn btn-outline" onclick="changePassword()">
                                <i class="fas fa-key"></i> Change Password
                            </button>
                            <button class="btn btn-outline" onclick="editProfile()">
                                <i class="fas fa-edit"></i> Edit Profile
                            </button>
                            <button class="btn btn-outline" style="color: var(--danger);" onclick="deleteAccount()">
                                <i class="fas fa-trash"></i> Delete Account
                            </button>
                        </div>
                    </div>
                </div>
            `;
  }

  // Change password - UPDATES DATABASE
  async function changePassword() {
    const oldPassword = prompt('Enter current password:');
    if (!oldPassword) return;

    const newPassword = prompt('Enter new password:');
    if (!newPassword) return;

    const confirmPassword = prompt('Confirm new password:');
    if (!confirmPassword) return;

    if (newPassword !== confirmPassword) {
      alert('Passwords do not match!');
      return;
    }

    try {
      const response = await fetch(`${API_BASE_URL}/api/user/changePassword`, {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          oldPassword: oldPassword,
          newPassword: newPassword
        })
      });

      if (response.ok) {
        alert('Password changed successfully!');
      } else {
        throw new Error('Password change failed');
      }
    } catch (error) {
      console.error('Password change error:', error);
      alert('Failed to change password. Please try again.');
    }
  }

  // Edit profile
  function editProfile() {
    const newEmail = prompt('Enter new email:', currentUser.email);
    if (newEmail && newEmail !== currentUser.email) {
      // Update profile in database
      updateUserProfile(newEmail);
    }
  }

  // Update user profile - UPDATES DATABASE
  async function updateUserProfile(newEmail) {
    try {
      const response = await fetch(`${API_BASE_URL}/api/user`, {
        method: 'PUT',
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          id: currentUser.id,
          username: currentUser.username,
          email: newEmail
        })
      });

      if (response.ok) {
        currentUser.email = newEmail;
        localStorage.setItem('user', JSON.stringify(currentUser));
        document.getElementById('userEmail').textContent = newEmail;
        alert('Profile updated successfully!');
      } else {
        throw new Error('Profile update failed');
      }
    } catch (error) {
      console.error('Profile update error:', error);
      alert('Failed to update profile. Please try again.');
    }
  }

  // Delete account
  function deleteAccount() {
    if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
      // Call API to delete account
      alert('Account deletion would be processed here');
    }
  }

  // Close modal
  function closeModal() {
    document.getElementById('courseModal').style.display = 'none';
  }

  // Logout
  function logout() {
    if (confirm('Are you sure you want to logout?')) {
      localStorage.removeItem('token');
      localStorage.removeItem('user');
      token = null;
      currentUser = null;
      showLogin();
    }
  }

  // Demo data functions (fallback if API is not available)
  function getDemoCourses() {
    return [
      {
        id: 1,
        title: "Web Development Bootcamp",
        description: "Learn full-stack web development from scratch with HTML, CSS, JavaScript, and Node.js",
        instructor: "John Smith",
        duration: "40 hours",
        students: 1250,
        rating: 4.8,
        level: "Beginner",
        category: "Programming"
      },
      {
        id: 2,
        title: "Data Science Fundamentals",
        description: "Master data analysis, visualization, and machine learning basics",
        instructor: "Sarah Johnson",
        duration: "35 hours",
        students: 890,
        rating: 4.6,
        level: "Intermediate",
        category: "Data Science"
      },
      {
        id: 3,
        title: "Mobile App Development",
        description: "Build native iOS and Android apps with React Native",
        instructor: "Mike Chen",
        duration: "30 hours",
        students: 720,
        rating: 4.7,
        level: "Intermediate",
        category: "Mobile Development"
      },
      {
        id: 4,
        title: "UI/UX Design Principles",
        description: "Learn user-centered design methodologies and prototyping",
        instructor: "Emma Wilson",
        duration: "25 hours",
        students: 540,
        rating: 4.9,
        level: "Beginner",
        category: "Design"
      },
      {
        id: 5,
        title: "Python for Beginners",
        description: "Start your programming journey with Python basics",
        instructor: "David Brown",
        duration: "20 hours",
        students: 2100,
        rating: 4.5,
        level: "Beginner",
        category: "Programming"
      },
      {
        id: 6,
        title: "Cloud Computing with AWS",
        description: "Learn to deploy and manage applications on Amazon Web Services",
        instructor: "Lisa Wang",
        duration: "45 hours",
        students: 430,
        rating: 4.8,
        level: "Advanced",
        category: "Cloud Computing"
      }
    ];
  }

  function getDemoEnrollments() {
    return [
      { id: 1, courseId: 1, userId: 1, progress: 65, enrolledAt: "2024-01-10T09:30:00Z" },
      { id: 2, courseId: 3, userId: 1, progress: 30, enrolledAt: "2024-01-15T14:20:00Z" },
      { id: 3, courseId: 4, userId: 1, progress: 10, enrolledAt: "2024-01-20T11:15:00Z" }
    ];
  }

  function getRandomColor() {
    const colors = ['#4361ee', '#3a0ca3', '#4cc9f0', '#4895ef', '#560bad', '#7209b7'];
    return colors[Math.floor(Math.random() * colors.length)];
  }

  function getCourseIcon(category) {
    const icons = {
      'Programming': 'fa-code',
      'Data Science': 'fa-chart-bar',
      'Mobile Development': 'fa-mobile-alt',
      'Design': 'fa-palette',
      'Cloud Computing': 'fa-cloud',
      'default': 'fa-book'
    };
    return icons[category] || icons.default;
  }
</script>
</body>
</html>