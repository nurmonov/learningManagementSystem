<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Controller Frontend</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
      padding: 20px;
    }
    .card {
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .response-area {
      background-color: #f8f9fa;
      border-radius: 5px;
      padding: 15px;
      margin-top: 10px;
      min-height: 100px;
      font-family: monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
    .btn-group {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1 class="text-center mb-4">Test Controller Frontend</h1>
  <p class="text-center text-muted mb-5">Spring Boot backend API bilan muloqot</p>

  <!-- 1. Hello Endpoint -->
  <div class="card">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">/api/test/hello</h5>
    </div>
    <div class="card-body">
      <p class="card-text">Oddiy matn qaytaruvchi GET so'rovi</p>
      <div class="btn-group">
        <button class="btn btn-success" onclick="callHello()">Hello so'rovini yuborish</button>
      </div>
      <div class="response-area" id="hello-response">
        Natija bu yerda ko'rinadi...
      </div>
    </div>
  </div>

  <!-- 2. Users Endpoint -->
  <div class="card">
    <div class="card-header bg-success text-white">
      <h5 class="mb-0">/api/test/users</h5>
    </div>
    <div class="card-body">
      <p class="card-text">JSON formatida foydalanuvchilar ro'yxatini qaytaruvchi GET so'rovi</p>
      <div class="btn-group">
        <button class="btn btn-success" onclick="callUsers()">Users so'rovini yuborish</button>
      </div>
      <div class="response-area" id="users-response">
        Natija bu yerda ko'rinadi...
      </div>
    </div>
  </div>

  <!-- 3. Greet Endpoint -->
  <div class="card">
    <div class="card-header bg-warning text-dark">
      <h5 class="mb-0">/api/test/greet</h5>
    </div>
    <div class="card-body">
      <p class="card-text">Parametr qabul qiluvchi GET so'rovi</p>
      <div class="mb-3">
        <label for="name-input" class="form-label">Ismingizni kiriting:</label>
        <div class="input-group">
          <input type="text" class="form-control" id="name-input" placeholder="Ism" value="Ali">
          <button class="btn btn-success" onclick="callGreet()">Greet so'rovini yuborish</button>
        </div>
        <small class="form-text text-muted">Hech narsa yozmasangiz, "Mehmon" ismi ishlatiladi</small>
      </div>
      <div class="response-area" id="greet-response">
        Natija bu yerda ko'rinadi...
      </div>
    </div>
  </div>

  <!-- Umumiy so'rovlar -->
  <div class="card">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0">Barcha so'rovlarni bir vaqtda yuborish</h5>
    </div>
    <div class="card-body">
      <p class="card-text">Barcha endpointlarga bir vaqtda so'rov yuborish</p>
      <div class="btn-group">
        <button class="btn btn-primary" onclick="callAllEndpoints()">Barchasini yuborish</button>
      </div>
      <div class="response-area" id="all-response">
        Barcha natijalar bu yerda ko'rinadi...
      </div>
    </div>
  </div>
</div>

<script>
  // API asosiy manzili
  const API_BASE_URL = 'http://localhost:8080/api/test';

  // 1. Hello endpoint
  async function callHello() {
    try {
      showLoading('hello-response');
      const response = await fetch(`${API_BASE_URL}/hello`);
      const data = await response.text();
      displayResponse('hello-response', data);
    } catch (error) {
      displayError('hello-response', error);
    }
  }

  // 2. Users endpoint
  async function callUsers() {
    try {
      showLoading('users-response');
      const response = await fetch(`${API_BASE_URL}/users`);
      const data = await response.json();
      // JSON ni chiroyli ko'rinishda ko'rsatish
      displayResponse('users-response', JSON.stringify(data, null, 2));
    } catch (error) {
      displayError('users-response', error);
    }
  }

  // 3. Greet endpoint
  async function callGreet() {
    try {
      const nameInput = document.getElementById('name-input').value;
      const url = `${API_BASE_URL}/greet${nameInput ? `?name=${encodeURIComponent(nameInput)}` : ''}`;

      showLoading('greet-response');
      const response = await fetch(url);
      const data = await response.text();
      displayResponse('greet-response', data);
    } catch (error) {
      displayError('greet-response', error);
    }
  }

  // Barcha endpointlarni bir vaqtda chaqirish
  async function callAllEndpoints() {
    try {
      showLoading('all-response');
      const results = await Promise.all([
        fetch(`${API_BASE_URL}/hello`).then(r => r.text()),
        fetch(`${API_BASE_URL}/users`).then(r => r.json()),
        fetch(`${API_BASE_URL}/greet?name=Frontend`).then(r => r.text())
      ]);

      const output = `1. /hello:\n${results[0]}\n\n2. /users:\n${JSON.stringify(results[1], null, 2)}\n\n3. /greet?name=Frontend:\n${results[2]}`;
      displayResponse('all-response', output);
    } catch (error) {
      displayError('all-response', error);
    }
  }

  // Yordamchi funksiyalar
  function showLoading(elementId) {
    document.getElementById(elementId).innerHTML = '<div class="text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Yuklanmoqda...</span></div><p>Yuklanmoqda...</p></div>';
  }

  function displayResponse(elementId, data) {
    const element = document.getElementById(elementId);
    element.innerHTML = `<strong>Natija:</strong>\n${data}`;
    element.classList.remove('text-danger');
    element.classList.add('text-success');
  }

  function displayError(elementId, error) {
    const element = document.getElementById(elementId);
    element.innerHTML = `<strong>Xato:</strong>\n${error.message || error}`;
    element.classList.remove('text-success');
    element.classList.add('text-danger');
  }

  // Sahifa yuklanganda bir marta hello so'rovini yuborish
  document.addEventListener('DOMContentLoaded', function() {
    // callHello();
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>